<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Bulk Mailer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{padding:30px}
    .left-col{width:48%; display:inline-block; vertical-align:top}
    .right-col{width:48%; display:inline-block; vertical-align:top}
  </style>
</head>
<body>
  <div class="container" style="max-width:900px">
    <div style="float:right">
      <a href="/logout" class="btn btn-success">Logout</a>
    </div>
    <h3>Bulk Mail Sender</h3>

    {% if message %}
      <script>alert("{{ message }}");</script>
    {% endif %}

    <form method="post" action="/send">
      <div class="left-col">
        <div class="form-group">
          <label>First Name (Sender Name)</label>
          <input name="firstName" class="form-control" value="{{ formData.firstName | default('') }}" />
        </div>

        <div class="form-group">
          <label>App Password (leave blank to use server env)</label>
          <input name="appPassword" class="form-control" value="{{ formData.appPassword | default('') }}" />
        </div>

        <div class="form-group">
          <label>Body</label>
          <textarea name="body" class="form-control" rows="10">{{ formData.body | default('') }}</textarea>
        </div>
      </div>

      <div class="right-col">
        <div class="form-group">
          <label>Sent From (your sender email)</label>
          <input name="sentFrom" class="form-control" value="{{ formData.sentFrom | default('') }}" />
        </div>

        <div class="form-group">
          <label>Subject</label>
          <input name="subject" class="form-control" value="{{ formData.subject | default('') }}" />
        </div>

        <div class="form-group">
          <label>Bulk Mails (one per line or comma separated) â€” max 30</label>
          <textarea id="bulkMails" name="bulkMails" class="form-control" rows="12">{{ formData.bulkMails | default('') }}</textarea>
          <small id="bulkCount"></small>
        </div>
      </div>

      <div style="clear:both; margin-top:20px">
        <p><strong>{{ formData.bulkMails | default('') | split('\n') | length }}</strong> recipient mail addresses are entered</p>
        <button class="btn btn-success">Send</button>
      </div>
    </form>
  </div>

  <script>
    const bulkArea = document.getElementById('bulkMails');
    const bulkCount = document.getElementById('bulkCount');
    function updateCount() {
      if (!bulkArea) return;
      const arr = bulkArea.value.split(/[\n,;]+/).map(s => s.trim()).filter(Boolean);
      bulkCount.textContent = arr.length + ' IDs entered';
    }
    if (bulkArea) {
      bulkArea.addEventListener('input', updateCount);
      updateCount();
    }
  </script>
</body>
</html>
